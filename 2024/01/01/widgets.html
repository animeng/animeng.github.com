<!DOCTYPE html>
<html>
<head>
    <link rel="shortcut icon" href="">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>çµåŠ¨å²›æŒ‰é’®äº¤äº’äº‹ä»¶åŸç†æ¢ç©¶ </title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="èµ°è‡ªå·±çš„è·¯ï¼Œè®©åˆ«äººè¯´å»å§">
    <meta name="author" content="mengtnt">
    <meta name="keywords" content="">
    <link rel="canonical" href="https://mengtnt.com/2024/01/01/widgets.html">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/pixyll.css" type="text/css">

    <!-- Fonts -->
    <!-- <link href='//fonts.useso.com/css?family=Merriweather:900,900italic,300,300italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.useso.com/css?family=Lato:900,300' rel='stylesheet' type='text/css'> -->
    
      <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    

    <!-- Open Graph -->
    <!-- From: https://github.com/mmistakes/hpstr-jekyll-theme/blob/master/_includes/head.html -->
    <meta property="og:locale" content="en_US">
    <meta property="og:type" content="article">
    <meta property="og:title" content="çµåŠ¨å²›æŒ‰é’®äº¤äº’äº‹ä»¶åŸç†æ¢ç©¶">
    <meta property="og:description" content="èµ°è‡ªå·±çš„è·¯ï¼Œè®©åˆ«äººè¯´å»å§">
    <meta property="og:url" content="https://mengtnt.com/2024/01/01/widgets.html">
    <meta property="og:site_name" content="mengtntçš„Blog">
    

</head>

<body class="">
  <div class="site-wrap">
    <header class="site-header px2 px-responsive">
  <div class="mt2 wrap">
    <div class="measure">
      <a href="https://mengtnt.com" class="site-title">mengtntçš„Blog</a>
      <nav class="site-nav right">
        <a href="/about/">å…³äº</a>
<a href="/contact/">è”ç³»</a>

      </nav>
      <div class="clearfix"></div>
      
        <div class="social-icons">
  <div class="left">
    
      <a class="fa fa-github" href="https://github.com/animeng"></a>
    
    
      <a class="fa fa-twitter" href="https://twitter.com/mengtnt"></a>
    
    
      <a class="social fa fa-weibo" href="https://weibo.com/mengtnt"></a>
    
    
    
      <a class="fa fa-envelope" href="mailto:animeng68@gmail.com"></a>
    
    
  </div>
  <div class="right">
    
    
    
  </div>
</div>
<div class="clearfix"></div>

      
    </div>
  </div>
</header>


    <div class="post p2 p-responsive wrap" role="main">
      <div class="measure">
        


<div class="post-header mb2">
  
  <h1 class="py2">çµåŠ¨å²›æŒ‰é’®äº¤äº’äº‹ä»¶åŸç†æ¢ç©¶</h1>
  
  <span class="post-meta">01æœˆ 01æ—¥, 2024</span><br>
  
  <span class="post-meta small">6 minute read</span>
</div>

<article class="post-content">
  <h1 id="é—®é¢˜èƒŒæ™¯">é—®é¢˜èƒŒæ™¯</h1>

<p>è‹¹æœ WWDC2023 Widgets å¢åŠ äº†æ–°çš„äº¤äº’èƒ½åŠ›ï¼ŒiOS17 ä»¥å‰ Widgets åªèƒ½å±•ç¤ºï¼Œæ— æ³•å“åº” UI ä¸Šæ‰€æœ‰çš„æŒ‰é’®äº‹ä»¶ï¼Œåªèƒ½è·³è½¬åˆ°ä¸» App ä¸­ã€‚iOS17 ä¹‹åï¼Œé€šè¿‡è¿™ä¸ªæ–°çš„äº¤äº’èƒ½åŠ›ï¼Œå°±å¯ä»¥å®ç° Widgets ä¸Šé¢çš„æŒ‰é’®ç‚¹å‡»äº‹ä»¶ã€‚å¦‚æœæ„Ÿå…´è¶£å¯ä»¥çœ‹ä¸‹è‹¹æœçš„<a href="https://developer.apple.com/videos/play/wwdc2023/10028/">WWDCè§†é¢‘</a>å’Œ<a href="https://developer.apple.com/documentation/widgetkit/adding-interactivity-to-widgets-and-live-activities">å®˜æ–¹æ–‡æ¡£</a>ï¼Œä¸‹é¢ä¼šç®€å•çš„ä»‹ç»ä¸‹è‹¹æœå®ç°çµåŠ¨å²› (LiveActivity Widget) ä¸ŠæŒ‰é’®å“åº”çš„æ–¹å¼å’Œå¼€å‘çš„è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜ã€‚</p>

<h2 id="1-çµåŠ¨å²›å¦‚ä½•å¢åŠ æŒ‰é’®å“åº”äº‹ä»¶">1. çµåŠ¨å²›å¦‚ä½•å¢åŠ æŒ‰é’®å“åº”äº‹ä»¶</h2>

<p>æ ¹æ®è‹¹æœçš„ Widgets çš„é€»è¾‘ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å†™çš„æ‰€æœ‰ SwiftUI çš„ä»£ç ä¼šæ”¾åœ¨ Widgets Extension çš„è¿›ç¨‹ä¸­ï¼Œä½†æ˜¯åœ¨ SwiftUI ä»£ç ä¸­æ‰€æœ‰çš„å¼‚æ­¥äº‹ä»¶éƒ½æ— æ³•æ‰§è¡Œï¼Œä¾‹å¦‚æŒ‰é’®äº‹ä»¶ã€ä¸‹è½½äº‹ä»¶ç­‰ç­‰ã€‚å¯ä»¥çœ‹ä¸‹åœ¨ Widgets Extension ä¸­ç¼–å†™ä¸‹é¢çš„ä»£ç ï¼Œ<code class="highlighter-rouge">print("test")</code> è¿™è¡Œä»£ç æ˜¯æ²¡æ³•æ‰§è¡Œçš„ã€‚</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kt">DynamicIslandExpandedRegion</span><span class="p">(</span><span class="o">.</span><span class="n">bottom</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">Button</span><span class="p">(</span><span class="s">"Start"</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"test"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<p>çŒœæµ‹è‹¹æœåœ¨ Extension è¿›ç¨‹ä¸­ï¼ŒæŠŠæ‰€æœ‰å¼‚æ­¥äº‹ä»¶æ³¨å†Œçš„èƒ½åŠ›ç»™æ‹”é™¤äº†ã€‚</p>

<p>é‚£ iOS17 ä¹‹åçµåŠ¨å²›çš„ Widgets åˆæ˜¯æ€ä¹ˆæ¥å“åº”å¼‚æ­¥äº‹ä»¶å‘¢ï¼Ÿè‹¹æœæ˜¯ç”¨ Intent çš„æ–¹å¼æ¥æ‰§è¡Œçš„ï¼Œè¿™æ ·éœ€è¦æ³¨å†Œä¸€ä¸ª Intent ç±»ï¼Œç„¶åæ¥æ‰§è¡Œäº‹ä»¶çš„ä»£ç ã€‚ç¤ºä¾‹ä¸­æŒ‰é’®æ³¨å†Œçš„ä»£ç å¦‚ä¸‹ï¼š</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kt">DynamicIslandExpandedRegion</span><span class="p">(</span><span class="o">.</span><span class="n">bottom</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">Button</span><span class="p">(</span><span class="nv">intent</span><span class="p">:</span> <span class="kt">ConfigurationAppIntent</span><span class="p">())</span> <span class="p">{</span>
        <span class="kt">Image</span><span class="p">(</span><span class="nv">systemName</span><span class="p">:</span> <span class="s">"plus.circle.fill"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<p>åœ¨æ¥æ”¶çš„æ¨¡å—éœ€è¦å®ç°ä¸€ä¸ª Intent çš„ç±»ï¼Œå¦‚ä¸‹ï¼š</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">struct</span> <span class="kt">ConfigurationAppIntent</span><span class="p">:</span> <span class="kt">WidgetConfigurationIntent</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="k">var</span> <span class="nv">title</span><span class="p">:</span> <span class="kt">LocalizedStringResource</span> <span class="o">=</span> <span class="s">"Configuration"</span>
    <span class="kd">static</span> <span class="k">var</span> <span class="nv">description</span> <span class="o">=</span> <span class="kt">IntentDescription</span><span class="p">(</span><span class="s">"This is an example widget."</span><span class="p">)</span>
    
    <span class="kd">func</span> <span class="nf">perform</span><span class="p">()</span> <span class="n">async</span> <span class="k">throws</span> <span class="o">-&gt;</span> <span class="kd">some</span> <span class="kt">IntentResult</span> <span class="p">{</span>
        <span class="kt">ShareData</span><span class="o">.</span><span class="nf">updateButtonStatus</span><span class="p">()</span>
        <span class="k">return</span> <span class="o">.</span><span class="nf">result</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<p>æŒ‰ç…§ä¸Šè¿°çš„æ–¹å¼ï¼ŒæŒ‰é’®ç‚¹å‡»æ—¶ï¼Œå°±å¯ä»¥æ‰§è¡Œ <code class="highlighter-rouge">updateButtonStatus</code> è¿™ä¸ªæ–¹æ³•äº†ï¼Œä¸‹é¢æ˜¯ <code class="highlighter-rouge">updateButtonStatus</code> è¿™ä¸ªæ–¹æ³•æ‰§è¡Œçš„é€»è¾‘ï¼Œå°±æ˜¯åœ¨å…±äº«çš„ group ä¸­å­˜å‚¨æ•°æ®ï¼Œç„¶åä¸»è¿›ç¨‹å°±å¯ä»¥è¯»å–æ•°æ®çš„å˜åŒ–äº†ã€‚</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">public</span> <span class="kd">struct</span> <span class="kt">ShareData</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="k">let</span> <span class="nv">appGroup</span> <span class="o">=</span> <span class="s">"com.mengtnt.myGroup"</span>
    
    <span class="kd">private</span> <span class="kd">static</span> <span class="k">var</span> <span class="nv">currentActivity</span><span class="p">:</span> <span class="kt">Activity</span><span class="o">&lt;</span><span class="kt">DynamicIslandAttributes</span><span class="o">&gt;</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>
    
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">func</span> <span class="nf">value</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">Int</span> <span class="p">{</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">result</span> <span class="o">=</span> <span class="kt">UserDefaults</span><span class="p">(</span><span class="nv">suiteName</span><span class="p">:</span> <span class="n">appGroup</span><span class="p">)?</span><span class="o">.</span><span class="nf">value</span><span class="p">(</span><span class="nv">forKey</span><span class="p">:</span> <span class="s">"value"</span><span class="p">)</span> <span class="k">as?</span> <span class="kt">Int</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="p">}</span>
    
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">func</span> <span class="nf">updateButtonStatus</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">var</span> <span class="nv">result</span> <span class="o">=</span> <span class="nf">value</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="kt">UserDefaults</span><span class="p">(</span><span class="nv">suiteName</span><span class="p">:</span> <span class="n">appGroup</span><span class="p">)?</span><span class="o">.</span><span class="nf">setValue</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="s">"value"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<p>è¿™é‡Œå±•ç¤ºä¸‹è¿è¡Œæ•ˆæœã€‚
<img src="https://ata2-img.oss-cn-zhangjiakou.aliyuncs.com/neweditor/36818385-adb4-4aea-9839-5034a33edcd2.gif" alt="" /></p>

<h2 id="2-é‡åˆ°äº‹ä»¶æ— å“åº”çš„é—®é¢˜">2. é‡åˆ°äº‹ä»¶æ— å“åº”çš„é—®é¢˜</h2>

<p>ç”±äºé’‰é’‰éƒ½æ˜¯åŸºäº Framework å¼€å‘çš„ï¼Œå¹¶ä¸æ˜¯å…¨æºç ç¼–è¯‘ã€‚æ‰€ä»¥è¿™é‡Œæ¨¡æ‹Ÿäº†é’‰é’‰çš„æ–¹å¼ï¼Œå†™äº†å¦‚ä¸‹çš„å·¥ç¨‹ã€‚æ‰€æœ‰çš„ Intent å’Œ LiveActivity çš„ä»£ç éƒ½æ”¾åˆ°äº†ä¸€ä¸ªå« Appintent çš„ Framework ä¸‹ã€‚ç„¶åç›¸åº”çš„ç±»å¼•ç”¨è¿™ä¸ª Frameworkï¼Œè¿™ä¸ªå·¥ç¨‹ä¸­ä»»ä½•æºç éƒ½æ²¡æ”¹åŠ¨ã€‚</p>

<p><img src="https://ata2-img.oss-cn-zhangjiakou.aliyuncs.com/neweditor/a8d66e3a-d13a-49e7-9a91-240e07846ae5.png" alt="" /></p>

<p>ç„¶åç¥å¥‡çš„ä¸€å¹•å°±å‘ç”Ÿäº†ï¼ŒçµåŠ¨å²›ä¸Šçš„æŒ‰é’®äº‹ä»¶æ²¡æœ‰ä»»ä½•ååº”ã€‚å¹¶ä¸”ç›¸åº”çš„ä»£ç ä¹Ÿä¸ä¼šè°ƒç”¨ã€‚æ•ˆæœå¦‚ä¸‹:
<img src="https://ata2-img.oss-cn-zhangjiakou.aliyuncs.com/neweditor/15b84045-781d-4763-97aa-697d238d1185.gif" alt="" /></p>

<p>ç„¶åæ¨æµ‹æ˜¯ä¸æ˜¯ç”¨ Framework çš„æ–¹å¼ï¼Œè‹¹æœæŠŠ Intent çš„ä»£ç è°ƒç”¨ç»™è£å‰ªæ‰äº†ï¼Œç„¶åç”¨ hopper åˆ†åˆ«æ‰“å¼€äº†ä¸¤ç§æ–¹å¼ä¸‹ç”Ÿæˆçš„æœ€ç»ˆäº§ç‰©ï¼Œåˆ†åˆ«æœç´¢æŒ‰é’®å“åº”äº‹ä»¶è°ƒç”¨çš„ <code class="highlighter-rouge">updateButtonStatus</code> æ–¹æ³•.</p>

<p><img src="https://ata2-img.oss-cn-zhangjiakou.aliyuncs.com/neweditor/b6f0b3b1-2922-4649-ae47-2f706a7ae3ad.png" alt="" /></p>

<p>ç„¶åé€šè¿‡ hopper è·³è½¬åˆ°è°ƒç”¨çš„å‡½æ•°åœ°å€ï¼Œå°±ä¼šå‘ç°è°ƒç”¨çš„å‡½æ•°éƒ½æ˜¯ Intent ç±»çš„ perform æ–¹æ³•ã€‚æ‰€ä»¥ Intent ç±»çš„ perform æ–¹æ³•å…¶å®éƒ½å·²ç» link åˆ°äº†ç›®æ ‡ Target ä¸­ï¼Œåªæ˜¯ä¸¤ç§æ–¹å¼ç”Ÿæˆçš„ç¬¦å·åœ°å€ä¸ä¸€æ ·è€Œå·²ã€‚</p>

<p><img src="https://ata2-img.oss-cn-zhangjiakou.aliyuncs.com/neweditor/cd9f1768-5fbf-4c79-988a-d67bd2ad3b09.png" alt="" /></p>

<p><img src="https://ata2-img.oss-cn-zhangjiakou.aliyuncs.com/neweditor/2b51b1a6-71df-41ee-9b6e-9637351933be.png" alt="" /></p>

<p>æ‰€ä»¥åº”è¯¥ä¸æ˜¯å…ˆå‰çš„çŒœæµ‹ï¼Œç”¨ Framework çš„æ–¹å¼æ‰§è¡Œçš„ç›®æ ‡ä»£ç åº”è¯¥æ²¡æœ‰è¢«è£å‰ªã€‚é‚£ä¹ˆæ‰§è¡Œçš„ä»£ç éƒ½ç”Ÿæˆäº†ï¼Œåˆä¼šæ˜¯ä»€ä¹ˆåŸå› é€ æˆæŒ‰é’®äº‹ä»¶æ— å“åº”å‘¢ï¼Ÿ</p>

<h2 id="3-æ‰¾å‡º-intent-è°ƒç”¨çš„çœŸç›¸">3. æ‰¾å‡º Intent è°ƒç”¨çš„çœŸç›¸</h2>

<p>ç„¶åå°±ç»§ç»­å¯¹æ¯”äº†ä¸‹å…¨æºç ç¼–è¯‘çš„äº§ç‰©å’Œ Framework æ–¹å¼ç¼–è¯‘çš„æœ€ç»ˆäº§ç‰©ã€‚å‘ç°å…¨æºç ç¼–è¯‘åœ¨ Extension Target ä¸‹é¢å¤šäº†è¿™ä¸ªæ–‡ä»¶å¤¹ MetaData.appintentsï¼Œä½†æ˜¯ Framework æ–¹å¼å¹¶æ²¡æœ‰ã€‚</p>

<p><img src="https://ata2-img.oss-cn-zhangjiakou.aliyuncs.com/neweditor/d6ed9ea9-2012-4ef8-9ef8-a459a0033e3d.png" alt="" /></p>

<p>æ‰“å¼€è¿™ä¸ªæ–‡ä»¶ï¼Œå‘ç°é‡Œé¢æœ‰ä¸€ä¸ª extract.actionsdata çš„ json æ–‡ä»¶ï¼Œé‡Œé¢æ³¨å†Œäº†ä¸€ä¸ª mangledTypeName åå­—ã€‚</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">
</span><span class="p">{</span><span class="w">
    </span><span class="nl">"generator"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"xcode-tools"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"15.0"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"enums"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
    </span><span class="nl">"queries"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
    </span><span class="nl">"autoShortcuts"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
    </span><span class="nl">"version"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nl">"entities"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
    </span><span class="nl">"negativePhrases"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
    </span><span class="nl">"actions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"ConfigurationAppIntent"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"outputFlags"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
            </span><span class="nl">"isDiscoverable"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
            </span><span class="nl">"typeSpecificMetadata"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
            </span><span class="nl">"requiredCapabilities"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
            </span><span class="nl">"effectiveBundleIdentifiers"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
            </span><span class="nl">"parameters"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
            </span><span class="nl">"systemProtocolMetadata"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="s2">"com.apple.link.systemProtocol.WidgetConfiguration"</span><span class="p">,</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="nl">"empty"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">],</span><span class="w">
            </span><span class="nl">"descriptionMetadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nl">"searchKeywords"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
                </span><span class="nl">"descriptionText"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"This is an example widget."</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nl">"mangledTypeNameByBundleIdentifier"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
            </span><span class="nl">"title"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Configuration"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nl">"identifier"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ConfigurationAppIntent"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"systemProtocols"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="s2">"com.apple.link.systemProtocol.WidgetConfiguration"</span><span class="w">
            </span><span class="p">],</span><span class="w">
            </span><span class="nl">"authenticationPolicy"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
            </span><span class="nl">"presentationStyle"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
            </span><span class="nl">"mangledTypeName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"22DynamicIslandExtension22ConfigurationAppIntentV"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"availabilityAnnotations"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nl">"LNPlatformNameWildcard"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="nl">"introducedVersion"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nl">"openAppWhenRun"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"shortcutTileColor"</span><span class="p">:</span><span class="w"> </span><span class="mi">14</span><span class="w">
</span><span class="p">}</span><span class="w">

</span></code></pre></div></div>

<p>mangled type name åˆæ˜¯ä»€ä¹ˆï¼Œç®€å•çš„è®²å°±æ˜¯ç¼–è¯‘å™¨æ ¹æ®ç”¨æˆ·çš„ä»£ç ç”Ÿæˆçš„ç‰¹æ®Šç¬¦å·ï¼Œé‡Œé¢åŒ…å«äº†å¾ˆå¤šä¿¡æ¯ä¾‹å¦‚ç±»å‹ã€æ¥æ”¶çš„å‚æ•°ï¼Œè¿”å›ç±»å‹ï¼Œæ¨¡æ¿çš„æƒ…å†µç­‰ç­‰ã€‚å¦‚æœæ„Ÿå…´è¶£å¯ä»¥è¯¦ç»†äº†è§£ Swift è¯­è¨€å…³äº mangled type çš„åŸç†ã€‚è¯´ç™½äº† mangledTypeName å°±æ˜¯åœ¨ç¼–è¯‘å™¨ link çš„æ—¶å€™ï¼Œæ–¹ä¾¿è·å–å‡½æ•°è°ƒç”¨çš„çœŸæ­£åœ°å€ã€‚ç”¨ hopper æ‰“å¼€ï¼Œæœç´¢å®šä¹‰çš„ç¬¦å·åç§° <code class="highlighter-rouge">22DynamicIslandExtension22ConfigurationAppIntentV</code>ã€‚è¿™ä¸ªåå­—æ­£æ˜¯å‰é¢çœ‹åˆ°çš„ Intent ç±»çš„åœ°å€ç¬¦å·ã€‚</p>

<p><img src="https://ata2-img.oss-cn-zhangjiakou.aliyuncs.com/neweditor/5195cf4e-7a51-4832-a794-052753095045.png" alt="" /></p>

<p>é€šè¿‡æ­¤ mangledTypeName å°±å¯ä»¥æ‰¾åˆ°ç±»ç›¸åº”çš„å†…å­˜åœ°å€ï¼Œä»è€Œæ‰¾åˆ°æ‰§è¡Œçš„ perform æ–¹æ³•ã€‚</p>

<p><img src="https://ata2-img.oss-cn-zhangjiakou.aliyuncs.com/neweditor/6ba4e051-fa78-4ec7-bd3f-69cf655f5ade.png" alt="" /></p>

<p>é‚£é€šè¿‡åŒæ ·çš„æ–¹å¼ï¼Œå°±å¯»æ‰¾äº†ä¸‹ Framework æ–¹å¼ä¸‹çš„ Extension çš„äº§ç‰©ï¼Œç„¶åä½¿ç”¨ hopper æ‰“å¼€ï¼Œå¯»æ‰¾ç›¸åº”çš„ Intent ç±»çš„ç¬¦å·ï¼Œå‘ç°ä¸º <code class="highlighter-rouge">9AppIntent013ConfigurationaB0V</code>ï¼Œå¦‚ä¸‹å›¾ï¼Œè¿™é‡Œå¯ä»¥çœ‹å‡ºæ¥è¿™ä¸ªç¬¦å·æ˜¯å¸¦æœ‰ Framework åç§° AppIntentã€‚</p>

<p><img src="https://ata2-img.oss-cn-zhangjiakou.aliyuncs.com/neweditor/8ead5539-eadf-4fa7-8986-9e8415730c8b.png" alt="" /></p>

<p>ç„¶åç”¨ç±»ä¼¼çš„æ–¹å¼ï¼Œåœ¨ Extension Target ä¸‹é¢åˆ›å»ºäº† metadata.appintents æ–‡ä»¶å¤¹ï¼Œç„¶åé…ç½®äº†å¦‚ä¸‹æ•°æ®ï¼š</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"generator"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"xcode-tools"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"15.0"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"enums"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
    </span><span class="nl">"queries"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
    </span><span class="nl">"autoShortcuts"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
    </span><span class="nl">"version"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nl">"entities"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
    </span><span class="nl">"negativePhrases"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
    </span><span class="nl">"actions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"ConfigurationAppIntent"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nl">"outputFlags"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
            </span><span class="nl">"isDiscoverable"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
            </span><span class="nl">"typeSpecificMetadata"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
            </span><span class="nl">"requiredCapabilities"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
            </span><span class="nl">"effectiveBundleIdentifiers"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
            </span><span class="nl">"parameters"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
            </span><span class="nl">"systemProtocolMetadata"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="s2">"com.apple.link.systemProtocol.WidgetConfiguration"</span><span class="p">,</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="nl">"empty"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">],</span><span class="w">
            </span><span class="nl">"descriptionMetadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nl">"searchKeywords"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
                </span><span class="nl">"descriptionText"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"This is an example widget."</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nl">"mangledTypeNameByBundleIdentifier"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
            </span><span class="nl">"title"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nl">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Configuration"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nl">"identifier"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ConfigurationAppIntent"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"systemProtocols"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="s2">"com.apple.link.systemProtocol.WidgetConfiguration"</span><span class="w">
            </span><span class="p">],</span><span class="w">
            </span><span class="nl">"authenticationPolicy"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
            </span><span class="nl">"presentationStyle"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
            </span><span class="nl">"mangledTypeName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"9AppIntent013ConfigurationaB0V"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"availabilityAnnotations"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nl">"LNPlatformNameWildcard"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="nl">"introducedVersion"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nl">"openAppWhenRun"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"shortcutTileColor"</span><span class="p">:</span><span class="w"> </span><span class="mi">14</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
<p>è¿è¡Œåï¼Œæœç„¶æŒ‰é’®äº‹ä»¶å¯ä»¥å“åº”äº†ï¼Œå’Œå…¨æºç ç¼–è¯‘çš„è¿è¡Œç»“æœä¸€æ¨¡ä¸€æ ·ã€‚</p>

<h2 id="4-æ€»ç»“">4. æ€»ç»“</h2>

<p>é€šè¿‡ä¸Šé¢çš„å°è¯•ï¼Œæˆ‘ä»¬å¯ä»¥æ€»ç»“å‡ºæ¥è‹¹æœ Intent çš„è¿è¡ŒåŸç†ï¼Œå…¶å®æœ‰ç‚¹åƒ patch åŸç†ï¼ŒæŠŠå¼‚æ­¥äº‹ä»¶å“åº”çš„ä»£ç ï¼Œç”¨ metaData.appintents ä¸­å®šä¹‰çš„ç¬¦å·åœ°å€æ›¿æ¢ï¼Œç”¨æˆ·è¿è¡Œæ—¶å°±æ‰§è¡Œäº† metaData.appintents ä¸­å®šä¹‰çš„ action æ–¹æ³•ã€‚</p>

<p>å…¶å®è‹¹æœåœ¨å¼€å‘è€…æ–‡æ¡£çš„ä¸­æè¿°è¿‡ Intent çš„å¤§è‡´æ‰§è¡Œè¿‡ç¨‹ï¼Œä½†æ˜¯å…·ä½“çš„å®ç°æ–¹å¼å¹¶æ²¡æœ‰æè¿°ã€‚</p>

<p><img src="https://ata2-img.oss-cn-zhangjiakou.aliyuncs.com/neweditor/0393b314-2fcd-48b7-b5f7-eb0e0155a70e.png" alt="" /></p>

<p>é€šè¿‡è¿›ä¸€æ­¥éªŒè¯äº†ï¼ŒæŠŠ Intent ç±»æ”¾åˆ°äº†ä¸» App çš„ Target ä¸­ï¼Œç¼–è¯‘åï¼Œåœ¨ä¸»è¿›ç¨‹çš„ Target ä¸­åŒæ ·ä¼šç”Ÿæˆä¸€ä¸ª metaData.appintentsï¼Œç„¶åè¿è¡Œåï¼Œäº‹ä»¶å“åº”çš„ä»£ç å°±åœ¨ä¸»è¿›ç¨‹çš„ç©ºé—´ä¸­æ‰§è¡Œäº†ã€‚</p>

<p><img src="https://ata2-img.oss-cn-zhangjiakou.aliyuncs.com/neweditor/e2796830-7ab6-499a-b3b7-cc3796c4f256.png" alt="" /></p>

<p>æ‰€ä»¥æ€»ç»“ä¸‹ï¼ŒWidgets çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸçš„äº‹ä»¶å¾ªç¯ï¼Œæœ¬è´¨ä¸Šéƒ½æ˜¯ç³»ç»Ÿæ‰˜ç®¡çš„ã€‚ç„¶åå¦‚ä½•æ‰§è¡Œç”¨æˆ·çš„å¼‚æ­¥äº‹ä»¶å‘¢ï¼Ÿå°±åƒä¸Šé¢è¯´çš„ï¼Œåœ¨ç¼–è¯‘ Widgets ä»£ç çš„æ—¶å€™ï¼Œä¼šæ ¹æ®æ³¨å†Œçš„å¼‚æ­¥äº‹ä»¶ï¼Œç„¶åç”Ÿæˆ Intent ç±»çš„ç¬¦å·åœ°å€ï¼Œç„¶åä¼šæŠŠæ­¤ç¬¦å·åœ°å€æ”¾åˆ° metaData.appintents æ–‡ä»¶å¤¹ä¸‹ extract.actionsdata è¿™ä¸ª json æ–‡ä»¶ä¸­ã€‚å½“å¼‚æ­¥äº‹ä»¶è°ƒç”¨æ—¶ï¼Œç³»ç»Ÿå°±ä¼šæ›¿æ¢ä¸º Intent ç±»æ³¨å†Œçš„ perform æ–¹æ³•ã€‚ä¸è¿‡å‘ç° xcode åœ¨ç¼–è¯‘ Widgets Extension æ—¶ï¼Œå¦‚æœ Target æºç ä¸­æ²¡æœ‰ Intent è¿™ä¸ªç±»å°±ä¸ç”Ÿæˆè°ƒç”¨åœ°å€çš„ç¬¦å·æ•°æ®äº†ï¼Œä»è€Œé€ æˆä½¿ç”¨ Framework è¿™ç§æ–¹å¼ï¼Œæ— æ³•å“åº”å¼‚æ­¥äº‹ä»¶ï¼Œä¸çŸ¥é“æ˜¯è‹¹æœç‰¹æ„è¿™æ ·è®¾è®¡çš„ï¼Œè¿˜æ˜¯ç»™æˆ‘ä»¬å¼€å‘è€…åŸ‹çš„å°æƒŠå–œğŸ˜‚ã€‚</p>

</article>





<div class="pay" align="center">
  <h3 style="color:#4DD0E1;">å¦‚æœä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œè°¢è°¢ä½ çš„èµèµ</h3>
  <img src="https://cdn.jsdelivr.net/gh/animeng/animeng.github.com/images/pay-me.jpeg" alt="å›¾3" style="width:400px;">
  <p>
    å¦‚æœ‰ç–‘é—®<a href="/contact/">è¯·è”ç³»æˆ‘</a>
  </p>
</div>

<script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.0/dist/mermaid.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
<script>  
$(document).ready(function () {
  window.mermaid.initialize({
    startOnLoad: true,
    theme: "default",
  });
  window.mermaid.init(undefined, document.querySelectorAll('.language-mermaid'));
});
</script>

<div id="gitmentContainer"></div>
<link rel="stylesheet" href="/css/comment.css">
<script src="https://cdn.jsdelivr.net/gh/animeng/animeng.github.com/resource/gitment.browser.v1.js"></script>
<script>
var gitment = new Gitment({
    owner: 'animeng',
    repo: 'animeng.github.com',
    oauth: {
        client_id: 'Iv1.e26fdd0d45ec4f26',
        client_secret: '8d51965f69de8e300a42e151437b944f7cccf819',
    },
});
gitment.render('gitmentContainer');
</script>

		
	

      	
      </div>
    </div>
  </div>

  <footer class="footer">
  <div class="p2 wrap">
    <div class="measure mt1 center">
      <small>
	<a>Â© 2020 Mengtnt </a> 
  <a class="fa fa-rss" href="/feed.xml"></a>
  <br>
  <span>
    Site powered by <a href="https://jekyllrb.com/">Jekyll</a> &amp; <a href="https://pages.github.com/">Github Pages</a>.
  </span>
    </div>
  </div>
</footer>



</body>
</html>
